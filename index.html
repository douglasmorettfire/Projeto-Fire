<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8"/>
<title>Projeto Fire - Calculadora de PrecificaÃ§Ã£o</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
body{font-family:Arial,sans-serif;background:#f7f7f7;padding:20px;}
.box{max-width:800px;background:white;padding:26px;margin:40px auto;border-radius:12px;box-shadow:0 0 12px rgba(0,0,0,0.1);}
h1,h2,h3{margin-top:10px}
button{padding:10px 14px;border-radius:8px;border:none;background:#111;color:#fff;cursor:pointer;}
button.secondary{background:#444}
button:hover{opacity:.9}
input,select{width:100%;padding:8px;margin:6px 0}
.row{display:grid;grid-template-columns:2fr 1fr;gap:10px}
.row3{display:grid;grid-template-columns:2fr 1fr 1fr;gap:10px}
.result{margin-top:20px;display:none}
.block{background:#f3f3f3;padding:16px;border-radius:10px;margin-bottom:16px}
hr{margin:20px 0}
.tabbar{display:flex;gap:10px;margin-bottom:20px}
.tabbar button{flex:1}
.small{font-size:13px;color:#666}
</style>
</head>

<body>
<div class="box">

<h1>Projeto Fire ğŸ”¥</h1>

<div class="tabbar">
  <button onclick="showTab('basic')">Modo Iniciante</button>
  <button onclick="showTab('advanced')">Modo AvanÃ§ado</button>
</div>

<!-- BASIC -->
<div id="basicTab">
<h2>Calculadora Iniciante</h2>

<label>Custo do produto (R$)</label>
<input id="basicCost" type="number" step="0.01"/>

<label>Taxa do aplicativo (%)</label>
<input id="basicAppFee" type="number" step="0.1"/>
<div class="small">
Dica: iFood plano bÃ¡sico com antecipaÃ§Ã£o â‰ˆ 16% â€¢ Plano com entregador â‰ˆ 27%
</div>

<br>
<button onclick="calculateBasic()">Calcular</button>

<div id="basicResults" class="result">

<div class="block">
<strong>ğŸ“ BalcÃ£o</strong>
<div id="basicStorePrice"></div>
<div id="basicStoreMarkup"></div>
<div id="basicStoreCMV"></div>
<div id="basicStoreProfit"></div>
</div>

<div class="block">
<strong>ğŸšš Aplicativos</strong>
<div id="basicDeliveryPrice"></div>
<div id="basicDeliveryMarkup"></div>
<div id="basicDeliveryCMV"></div>
<div id="basicDeliveryProfit"></div>
</div>

</div>
</div>

<!-- ADVANCED -->
<div id="advancedTab" style="display:none;">

<h2>Calculadora AvanÃ§ada de Custos</h2>
<p class="small">Aqui vocÃª enxerga seus nÃºmeros reais. Nenhum preÃ§o Ã© sugerido.</p>

<label>PreÃ§o de venda atual (R$)</label>
<input id="advPrice" type="number" step="0.01"/>

<hr/>

<h3>ğŸ§¾ Insumos</h3>
<div id="ingredients">
  <div class="row">
    <input placeholder="Nome do insumo"/>
    <input type="number" step="0.01" placeholder="Custo"/>
  </div>
</div>
<button class="secondary" onclick="addIngredient()">+ Adicionar insumo</button>

<hr/>

<h3>ğŸ“¦ Embalagem</h3>
<div id="packages">
  <div class="row3">
    <input placeholder="Nome da embalagem"/>
    <input type="number" step="1" placeholder="Qtd usada"/>
    <input type="number" step="0.01" placeholder="Valor unitÃ¡rio"/>
  </div>
</div>
<button class="secondary" onclick="addPackage()">+ Adicionar embalagem</button>

<hr/>

<h3>ğŸ’³ Taxas</h3>
<label>Taxa de aplicativos de delivery (%) <span class="small">(iFood, Keeta)</span></label>
<input id="deliveryFee" type="number" step="0.01"/>

<label>Taxa da maquininha - DÃ©bito (%)</label>
<input id="cardDebitFee" type="number" step="0.01"/>

<label>Taxa da maquininha - CrÃ©dito (%)</label>
<input id="cardCreditFee" type="number" step="0.01"/>

<label>Taxa fixa por pedido (R$)</label>
<input id="fixedFee" type="number" step="0.01"/>

<br/><br/>

<button onclick="calculateAdvanced()">Analisar meu produto</button>

<div id="advancedResults" class="result">

<div class="block">
<strong>ğŸ“Š Resumo Financeiro</strong>
<div id="advIngredientCost"></div>
<div id="advPackagingCost"></div>
<div id="advFeesValue"></div>
<div id="advTotalCost"></div>
</div>

<div class="block">
<strong>ğŸ“ˆ Indicadores</strong>
<div id="advProfit"></div>
<div id="advMargin"></div>
<div id="advMarkup"></div>
<div id="advCMV"></div>
<div id="advSuggestedApp"></div>
<div id="advAlert"></div>
</div>

</div>
</div>

</div>

<script>
function showTab(tab){
 document.getElementById("basicTab").style.display=tab==="basic"?"block":"none";
 document.getElementById("advancedTab").style.display=tab==="advanced"?"block":"none";
}

function roundPsych(val){
 const endings=[0.9,4.9,6.9,9.9];
 let best=val, diff=999;
 endings.forEach(e=>{
   const base=Math.floor(val/10)*10+e;
   if(Math.abs(base-val)<diff){diff=Math.abs(base-val);best=base;}
 });
 return best;
}

function calculateBasic(){
 const cost=parseFloat(document.getElementById("basicCost").value)||0;
 const appFee=(parseFloat(document.getElementById("basicAppFee").value)||0)/100;

 const storePrice=roundPsych(cost*2.5);
 const storeProfit=storePrice-cost;
 const storeMarkup=(storePrice/cost);
 const storeCMV=(cost/storePrice)*100;

 const deliveryPrice=roundPsych((storeProfit+cost)/(1-appFee));
 const deliveryProfit=deliveryPrice*(1-appFee)-cost;
 const deliveryMarkup=(deliveryPrice/cost);
 const deliveryCMV=(cost/deliveryPrice)*100;

 document.getElementById("basicStorePrice").innerText="PreÃ§o balcÃ£o: R$ "+storePrice.toFixed(2);
 document.getElementById("basicStoreMarkup").innerText="Markup: "+storeMarkup.toFixed(2)+"x";
 document.getElementById("basicStoreCMV").innerText="CMV: "+storeCMV.toFixed(1)+"%";
 document.getElementById("basicStoreProfit").innerText="Lucro: R$ "+storeProfit.toFixed(2);

 document.getElementById("basicDeliveryPrice").innerText="PreÃ§o apps: R$ "+deliveryPrice.toFixed(2);
 document.getElementById("basicDeliveryMarkup").innerText="Markup: "+deliveryMarkup.toFixed(2)+"x";
 document.getElementById("basicDeliveryCMV").innerText="CMV: "+deliveryCMV.toFixed(1)+"%";
 document.getElementById("basicDeliveryProfit").innerText="Lucro: R$ "+deliveryProfit.toFixed(2);

 document.getElementById("basicResults").style.display="block";
}

function addIngredient(){
 const div=document.createElement("div");
 div.className="row";
 div.innerHTML='<input placeholder="Nome do insumo"/><input type="number" step="0.01" placeholder="Custo"/>';
 document.getElementById("ingredients").appendChild(div);
}

function addPackage(){
 const div=document.createElement("div");
 div.className="row3";
 div.innerHTML='<input placeholder="Nome da embalagem"/><input type="number" step="1" placeholder="Qtd usada"/><input type="number" step="0.01" placeholder="Valor unitÃ¡rio"/>';
 document.getElementById("packages").appendChild(div);
}

function calculateAdvanced(){
 const price=parseFloat(document.getElementById("advPrice").value)||0;
 const deliveryFee=parseFloat(document.getElementById("deliveryFee").value)||0;
 const cardDebitFee=parseFloat(document.getElementById("cardDebitFee").value)||0;
 const cardCreditFee=parseFloat(document.getElementById("cardCreditFee").value)||0;
 const fixedFee=parseFloat(document.getElementById("fixedFee").value)||0;

 let ingredientTotal=0;
 document.querySelectorAll("#ingredients .row").forEach(r=>{
   ingredientTotal+=parseFloat(r.children[1].value)||0;
 });

 let packagingTotal=0;
 document.querySelectorAll("#packages .row3").forEach(r=>{
   const q=parseFloat(r.children[1].value)||0;
   const v=parseFloat(r.children[2].value)||0;
   packagingTotal+=q*v;
 });

 const debitFeeValue = price*(cardDebitFee/100);
 const creditFeeValue = price*(cardCreditFee/100);

 const totalCostDebit = ingredientTotal + packagingTotal + debitFeeValue + fixedFee;
 const totalCostCredit = ingredientTotal + packagingTotal + creditFeeValue + fixedFee;

 const profitDebit = price - totalCostDebit;
 const profitCredit = price - totalCostCredit;

 const targetProfit = profitDebit;
 const suggestedAppPrice = targetProfit > 0 && deliveryFee > 0
   ? targetProfit / (1 - deliveryFee/100) + ingredientTotal + packagingTotal + debitFeeValue + fixedFee
   : 0;

 const margin = price>0 ? (profitDebit/price)*100 : 0;
 const markup = totalCostDebit>0 ? price/totalCostDebit : 0;
 const cmv = price>0 ? (totalCostDebit/price)*100 : 0;

 document.getElementById("advIngredientCost").innerText="Custo dos insumos: R$ "+ingredientTotal.toFixed(2);
 document.getElementById("advPackagingCost").innerText="Embalagem: R$ "+packagingTotal.toFixed(2);
 document.getElementById("advFeesValue").innerText="Taxas da maquininha + fixa: R$ "+(debitFeeValue + fixedFee).toFixed(2);
 document.getElementById("advTotalCost").innerText="Custo total (dÃ©bito): R$ "+totalCostDebit.toFixed(2)+" | CrÃ©dito: R$ "+totalCostCredit.toFixed(2);

 document.getElementById("advProfit").innerText="Lucro no dÃ©bito: R$ "+profitDebit.toFixed(2)+" | Lucro no crÃ©dito: R$ "+profitCredit.toFixed(2);
 document.getElementById("advMargin").innerText="Margem: "+margin.toFixed(1)+"%";
 document.getElementById("advMarkup").innerText="Markup real: "+markup.toFixed(2)+"x";
 document.getElementById("advCMV").innerText="CMV real: "+cmv.toFixed(1)+"%";

 document.getElementById("advSuggestedApp").innerText =
  suggestedAppPrice>0 ? "PreÃ§o sugerido no iFood para manter o lucro: R$ "+suggestedAppPrice.toFixed(2) : "";

 const alertBox=document.getElementById("advAlert");
 if(margin<20){
  alertBox.innerText="âš  Margem perigosa â€” esse produto pode estar comprometendo seu caixa.";
  alertBox.style.color="red";
 }else if(margin<30){
  alertBox.innerText="ğŸŸ¡ Margem apertada â€” cuidado com promoÃ§Ãµes.";
  alertBox.style.color="orange";
 }else{
  alertBox.innerText="ğŸŸ¢ Margem saudÃ¡vel.";
  alertBox.style.color="green";
 }

 document.getElementById("advancedResults").style.display="block";
}
</script>

</body>
</html>
